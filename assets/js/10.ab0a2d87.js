(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{398:function(t,a,s){t.exports=s.p+"assets/img/image-20220421190249290.e7d94972.png"},440:function(t,a,s){"use strict";s.r(a);var e=s(56),n=Object(e.a)({},(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"efcore-的-dbfirst-模式"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#efcore-的-dbfirst-模式"}},[t._v("#")]),t._v(" EFCore 的 DbFirst 模式")]),t._v(" "),e("p"),e("div",{staticClass:"table-of-contents"},[e("ul",[e("li",[e("a",{attrs:{href:"#_1-前言"}},[t._v("1 前言")])]),e("li",[e("a",{attrs:{href:"#_2-前置条件"}},[t._v("2 前置条件")])]),e("li",[e("a",{attrs:{href:"#_3-主命令"}},[t._v("3 主命令")])]),e("li",[e("a",{attrs:{href:"#_4-命令参数"}},[t._v("4 命令参数")])]),e("li",[e("a",{attrs:{href:"#_5-测试"}},[t._v("5 测试")]),e("ul",[e("li",[e("a",{attrs:{href:"#_5-1-数据库准备"}},[t._v("5.1 数据库准备")])]),e("li",[e("a",{attrs:{href:"#_5-2-新建一个控制台程序"}},[t._v("5.2 新建一个控制台程序")])]),e("li",[e("a",{attrs:{href:"#_5-3-引入-nuget-包"}},[t._v("5.3 引入 Nuget 包")])]),e("li",[e("a",{attrs:{href:"#_5-4-执行-scaffold-命令"}},[t._v("5.4 执行 Scaffold 命令")])]),e("li",[e("a",{attrs:{href:"#_5-5-测试源码"}},[t._v("5.5 测试源码")])]),e("li",[e("a",{attrs:{href:"#_5-6-源码"}},[t._v("5.6 源码")])])])]),e("li",[e("a",{attrs:{href:"#_6-ef-core-power-tools"}},[t._v("6 EF Core Power Tools")])]),e("li",[e("a",{attrs:{href:"#参考来源"}},[t._v("参考来源")])])])]),e("p"),t._v(" "),e("h2",{attrs:{id:"_1-前言"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-前言"}},[t._v("#")]),t._v(" 1 前言")]),t._v(" "),e("p",[t._v("EF Core 可以以数据库架构为准，通过"),e("a",{attrs:{href:"https://docs.microsoft.com/zh-cn/ef/core/managing-schemas/scaffolding",target:"_blank",rel:"noopener noreferrer"}},[t._v("反向工程"),e("OutboundLink")],1),t._v("生成EF Core 模型（称为 Db First 模式）。")]),t._v(" "),e("p",[t._v("在 EF6 时代，我们可以通过界面简单的操作，完成该功能。")]),t._v(" "),e("p",[t._v("EF Core 则需要通过 CLI 来进行该操作，具体请参考"),e("a",{attrs:{href:"https://docs.microsoft.com/zh-cn/ef/core/managing-schemas/scaffolding?tabs=dotnet-core-cli",target:"_blank",rel:"noopener noreferrer"}},[t._v("EF Core官方文档：反向工程"),e("OutboundLink")],1),t._v("。")]),t._v(" "),e("p",[t._v("当然，EF Core 也有界面化操作的工具，EF Core Power Tools，具体请见最后介绍。")]),t._v(" "),e("h2",{attrs:{id:"_2-前置条件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-前置条件"}},[t._v("#")]),t._v(" 2 前置条件")]),t._v(" "),e("ul",[e("li",[e("p",[e("a",{attrs:{href:"https://docs.microsoft.com/zh-cn/ef/core/cli/powershell",target:"_blank",rel:"noopener noreferrer"}},[t._v("PMC 工具"),e("OutboundLink")],1),t._v("（仅限 Visual Studio）或 "),e("a",{attrs:{href:"https://docs.microsoft.com/zh-cn/ef/core/cli/dotnet",target:"_blank",rel:"noopener noreferrer"}},[t._v("CLI 工具"),e("OutboundLink")],1),t._v("。")])]),t._v(" "),e("li",[e("p",[t._v("核心 NuGet 包：Microsoft.EntityFrameworkCore.Design")])]),t._v(" "),e("li",[e("p",[t._v("还需要为要进行反向工程的数据库架构安装适当的"),e("a",{attrs:{href:"https://docs.microsoft.com/zh-cn/ef/core/providers/",target:"_blank",rel:"noopener noreferrer"}},[t._v("数据库提供程序"),e("OutboundLink")],1)])])]),t._v(" "),e("h2",{attrs:{id:"_3-主命令"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-主命令"}},[t._v("#")]),t._v(" 3 主命令")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("dotnet ef dbcontext scaffold "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"[数据库连接串]"')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("提供程序"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),e("p",[t._v("如：")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("dotnet ef dbcontext scaffold "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"server=localhost;database=efcore;uid=sa;pwd=Qwe123456;"')]),t._v(" Microsoft.EntityFrameworkCore.SqlServer\n")])])]),e("h2",{attrs:{id:"_4-命令参数"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-命令参数"}},[t._v("#")]),t._v(" 4 命令参数")]),t._v(" "),e("h4",{attrs:{id:"_4-1-生成指定表-table"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-生成指定表-table"}},[t._v("#")]),t._v(" 4.1 生成指定表（--table）")]),t._v(" "),e("p",[t._v("上述命令，会生成整个数据库的表，如果需要指定特定的表，需要使用如下：")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("dotnet ef dbcontext scaffold "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"[数据库连接串]"')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("提供程序"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" --table table_name1 --table table_name2\n")])])]),e("h4",{attrs:{id:"_4-2-保留数据库名称-use-database-names"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-保留数据库名称-use-database-names"}},[t._v("#")]),t._v(" 4.2 保留数据库名称（--use-database-names）")]),t._v(" "),e("p",[t._v("默认情况会修正表/列名，使用该参数尽量保留原名称。")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("-UseDatabaseNames    "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#PMC")]),t._v("\n--use-database-names "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#.NET Core CLI")]),t._v("\n")])])]),e("h4",{attrs:{id:"_4-3-fluent-api-和数据注释-data-annotations"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-fluent-api-和数据注释-data-annotations"}},[t._v("#")]),t._v(" 4.3 Fluent API 和数据注释（--data-annotations）")]),t._v(" "),e("p",[t._v("默认情况下，使用 Fluent API 配置实体类型。使用下面的命令，可以改为使用数据注释。")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("-DataAnnotations   "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#PMC")]),t._v("\n--data-annotations "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#.NET Core CLI")]),t._v("\n")])])]),e("p",[t._v("Fluent API")]),t._v(" "),e("div",{staticClass:"language-csharp extra-class"},[e("pre",{pre:!0,attrs:{class:"language-csharp"}},[e("code",[t._v("entity"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Property")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" e"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Title"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("IsRequired")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("HasMaxLength")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("160")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),e("p",[t._v("数据注释")]),t._v(" "),e("div",{staticClass:"language-csharp extra-class"},[e("pre",{pre:!0,attrs:{class:"language-csharp"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token attribute"}},[e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Required")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token attribute"}},[e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("StringLength")]),e("span",{pre:!0,attrs:{class:"token attribute-arguments"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("160")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")])])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token return-type class-name"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("string")])]),t._v(" Title "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("get")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("set")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("h4",{attrs:{id:"_4-4-指定-dbcontext-名称-context"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-指定-dbcontext-名称-context"}},[t._v("#")]),t._v(" 4.4 指定 DbContext 名称（--context）")]),t._v(" "),e("p",[t._v("指定将生成的 DbContext 类的名称")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("-Context  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#PMC")]),t._v("\n--context "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#.NET Core CLI")]),t._v("\n")])])]),e("h4",{attrs:{id:"_4-5-指定保存目录-context-dir-和-output-dir"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-5-指定保存目录-context-dir-和-output-dir"}},[t._v("#")]),t._v(" 4.5 指定保存目录（--context-dir 和 --output-dir）")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("-ContextDir Data -OutputDir Models     "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#PMC")]),t._v("\n--context-dir Data --output-dir Models "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#.NET Core CLI")]),t._v("\n")])])]),e("h4",{attrs:{id:"_4-6-指定命名空间-namespace-和-context-namespace"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-6-指定命名空间-namespace-和-context-namespace"}},[t._v("#")]),t._v(" 4.6 指定命名空间（--namespace 和 --context-namespace）")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("-Namespace Your.Namespace -ContextNamespace Your.DbContext.Namespace    "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#PMC")]),t._v("\n--namespace Your.Namespace --context-namespace Your.DbContext.Namespace "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#.NET Core CLI")]),t._v("\n")])])]),e("h2",{attrs:{id:"_5-测试"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-测试"}},[t._v("#")]),t._v(" 5 测试")]),t._v(" "),e("p",[t._v("数据库：SQL Server2019")]),t._v(" "),e("p",[t._v("程序： .NET6.0 的控制台程序")]),t._v(" "),e("h3",{attrs:{id:"_5-1-数据库准备"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-数据库准备"}},[t._v("#")]),t._v(" 5.1 数据库准备")]),t._v(" "),e("p",[t._v("由于是 DbFirst，所以这里我们先创建一个数据库，名为 efcore")]),t._v(" "),e("p",[t._v("新建一张表 Test")]),t._v(" "),e("div",{staticClass:"language-sql extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CREATE")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("TABLE")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("dbo"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Test"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Id"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("uniqueidentifier"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Name"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("nvarchar"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("128")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CONSTRAINT")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("PK_Test"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("PRIMARY")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("KEY")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CLUSTERED")]),t._v(" \n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Id"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ASC")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WITH")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("PAD_INDEX "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("OFF")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" STATISTICS_NORECOMPUTE "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("OFF")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" IGNORE_DUP_KEY "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("OFF")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ALLOW_ROW_LOCKS "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ON")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ALLOW_PAGE_LOCKS "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ON")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ON")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("PRIMARY")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ON")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("PRIMARY")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),e("h3",{attrs:{id:"_5-2-新建一个控制台程序"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-新建一个控制台程序"}},[t._v("#")]),t._v(" 5.2 新建一个控制台程序")]),t._v(" "),e("p",[t._v("这里命名为：DbFirstTest")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" DbFirstTest "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" DbFirstTest "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#新建文件夹DbFirstTest并切换至该目录下")]),t._v("\ndotnet new console -f net6.0       "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#新建.NET6.0控制台程序")]),t._v("\n")])])]),e("h3",{attrs:{id:"_5-3-引入-nuget-包"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-引入-nuget-包"}},[t._v("#")]),t._v(" 5.3 引入 Nuget 包")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 引入 EF Core 核心包")]),t._v("\ndotnet "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),t._v(" package Microsoft.EntityFrameworkCore.Design -v "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("6.0")]),t._v(".4\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 引入 SQL Server 提供程序")]),t._v("\ndotnet "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),t._v(" package Microsoft.EntityFrameworkCore.SqlServer -v "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("6.0")]),t._v(".4\n")])])]),e("h3",{attrs:{id:"_5-4-执行-scaffold-命令"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-4-执行-scaffold-命令"}},[t._v("#")]),t._v(" 5.4 执行 Scaffold 命令")]),t._v(" "),e("p",[t._v("在控制台程序的根目录下，执行命令（连接串请自行修改成自己的）：")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("dotnet ef dbcontext scaffold "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"server=localhost;database=efcore;uid=sa;pwd=Qwe123456;"')]),t._v(" Microsoft.EntityFrameworkCore.SqlServer --data-annotations --context EfCoreContext --context-dir Data --output-dir Models\n")])])]),e("p",[t._v("--data-annotations：数据注释在实体上")]),t._v(" "),e("p",[t._v("--context EfCoreContext：上下文指定命名为 EfCoreContext")]),t._v(" "),e("p",[t._v("--context-dir Data：上下文保存在根目录的 Data 文件夹下")]),t._v(" "),e("p",[t._v("--output-dir Models：实体保存在根目录的 Models 文件夹下")]),t._v(" "),e("h3",{attrs:{id:"_5-5-测试源码"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-5-测试源码"}},[t._v("#")]),t._v(" 5.5 测试源码")]),t._v(" "),e("p",[t._v("在 Program.cs 添加测试代码：")]),t._v(" "),e("div",{staticClass:"language-csharp extra-class"},[e("pre",{pre:!0,attrs:{class:"language-csharp"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("using")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("DbFirstTest"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Data")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("using")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("DbFirstTest"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Models")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("EfCoreContext")]),t._v(" db "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token constructor-invocation class-name"}},[t._v("EfCoreContext")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Test")]),t._v(" test "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token constructor-invocation class-name"}},[t._v("Test")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    Id "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Guid"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("NewGuid")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    Name "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Add"')]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\ndb"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Tests"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Add")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("test"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\ndb"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("SaveChanges")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nConsole"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("WriteLine")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Add Successful！"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),e("p",[t._v("在项目根目录下，执行：")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("dotnet build "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#编译")]),t._v("\ndotnet run   "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#运行")]),t._v("\n")])])]),e("p",[t._v("执行以后，可以看到，数据库中添加了相应的记录。")]),t._v(" "),e("h3",{attrs:{id:"_5-6-源码"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-6-源码"}},[t._v("#")]),t._v(" 5.6 源码")]),t._v(" "),e("p",[t._v("Gitee：https://gitee.com/lisheng741/testnetcore/tree/master/EFCore/DbFirstTest")]),t._v(" "),e("p",[t._v("Github：https://github.com/lisheng741/testnetcore/tree/master/EFCore/DbFirstTest")]),t._v(" "),e("h2",{attrs:{id:"_6-ef-core-power-tools"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_6-ef-core-power-tools"}},[t._v("#")]),t._v(" 6 EF Core Power Tools")]),t._v(" "),e("p",[t._v("开源的 EF Core 界面工具，可以作为一个 vs 的插件，在 vs 里运作。")]),t._v(" "),e("p",[t._v("项目 Github 地址："),e("a",{attrs:{href:"https://github.com/ErikEJ/EFCorePowerTools/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/ErikEJ/EFCorePowerTools/"),e("OutboundLink")],1)]),t._v(" "),e("p",[t._v("VS 插件下载："),e("a",{attrs:{href:"https://marketplace.visualstudio.com/items?itemName=ErikEJ.EFCorePowerTools",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://marketplace.visualstudio.com/items?itemName=ErikEJ.EFCorePowerTools"),e("OutboundLink")],1)]),t._v(" "),e("p",[t._v("在 VS 插件市场下载以后，安装即可。")]),t._v(" "),e("p",[t._v("本人的 vs 版本是 vs2022，安装以后，右键项目多了一个选项【EF Core工具】，点击【反向工程】即可进行 DbFirst 的相关操作了。")]),t._v(" "),e("p",[t._v("界面化操作比较直观，这里不在赘述。")]),t._v(" "),e("p",[e("img",{attrs:{src:s(398),alt:"image-20220421190249290"}})]),t._v(" "),e("h2",{attrs:{id:"参考来源"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#参考来源"}},[t._v("#")]),t._v(" 参考来源")]),t._v(" "),e("p",[e("a",{attrs:{href:"https://docs.microsoft.com/zh-cn/ef/core/managing-schemas/scaffolding?tabs=dotnet-core-cli",target:"_blank",rel:"noopener noreferrer"}},[t._v("EF Core官方文档：反向工程"),e("OutboundLink")],1)])])}),[],!1,null,null,null);a.default=n.exports}}]);