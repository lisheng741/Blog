# 高级



## 访问 HttpContext

具体请参考[微软官方文档-在ASP.NET Core中访问HttpContext](https://docs.microsoft.com/zh-cn/aspnet/core/fundamentals/http-context?view=aspnetcore-6.0)

### 1 控制器中

通过 ControllerBase.HttpContext

```c#
HttpContext.Request.PathBase
```

### 2 自定义中间件

使用自定义中间件组件时，`HttpContext` 传递到 `Invoke` 或 `InvokeAsync` 方法，在中间件配置后可供访问：

```c#
public class MyCustomMiddleware
{
    public Task InvokeAsync(HttpContext context)
    {
        ...
    }
}
```

### 3 自定义组件

对于需要访问 `HttpContext` 的其他框架和自定义组件，建议使用内置的依赖项注入容器来注册依赖项。 依赖项注入容器向任意类提供 `IHttpContextAccessor`，以供类在自己的构造函数中将它声明为依赖项：

```c#
//Program.cs 中
services.AddHttpContextAccessor();
services.AddScoped<ITestService, TestService>();

//自定义组件中
public class TestService : ITestService
{
    private readonly IHttpContextAccessor _httpContextAccessor;
    
    public TestService(IHttpContextAccessor httpContextAccessor)
    {
        _httpContextAccessor = httpContextAccessor;
    }
    
    public void Show()
    {
        var para = _httpContextAccessor.HttpContext.Request.Query["parameter"];
    }
}
```

